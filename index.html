<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>List</title>
    <style>
        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            padding: 2rem 5%;
            font-family: 'Noto Serif Khmer', serif;
            background-color: #f8f9fa;
            color: #333;
        }

        h1 {
            text-align: center;
            color: #0245af;
            margin-bottom: 1.5rem;
            font-size: 2rem;
        }

        .content-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            gap: 10px;
        }

        .content-header p {
            font-size: 1.25rem;
            font-weight: bold;
            margin: 0;
        }

        .add-button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px 18px;
            font-size: 1rem;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.2s ease-in-out;
        }

        .add-button:hover {
            background-color: #45a049;
        }

        .song-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 16px;
        }

        .song-item {
            background-color: #ffffff;
            border-radius: 8px;
            padding: 14px 18px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            cursor: pointer;
        }

        .song-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        .song-title {
            font-size: 1.1rem;
            font-weight: bold;
            color: #0245af;
            margin-bottom: 0.3rem;
        }

        .song-timestamp {
            font-size: 0.85rem;
            color: #777;
        }

        .song-item.empty {
            text-align: center;
            font-style: italic;
            color: #aaa;
            border-left: none;
            background-color: transparent;
            box-shadow: none;
            cursor: default;
        }

        .song-id {
            font-weight: bold;
        }

        @media (max-width: 500px) {
            .add-button {
                width: 100%;
            }
        }
    </style>
</head>

<body>
<h1>List</h1>

<div class="content-header">
    <p>Songs</p>
    <button class="add-button" onclick="createNewSong()">Add New</button>
</div>

<div class="song-list" id="song-list"></div>

<script>

    async function inputSongTitle() {
        return prompt('Enter title');
    }

    function requestCreateNewSong(title, created_date) {
        fetch("http://127.0.0.1:8000/create_song", {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                title: title,
                created_date: created_date
            }),
        })
            .then(response => {
                if (!response.ok) {
                    throw new Error("Network response was not ok");
                }
                return response.json();
            })
            .then(data => {
                console.log("Song created:", data);
                updateSongList();
            })
            .catch(error => {
                console.error("Error creating song:", error);
            });
    }


    async function createNewSong() {
        const title = await inputSongTitle();
        const created_date = new Date().toISOString();

        if (!title) {
            alert('Please enter title!');
            return;
        }

        requestCreateNewSong(title, created_date)
    }


    function openCreateSongPage(songId) {
        window.location.href = `create.html?songId=${encodeURIComponent(songId)}`;
    }

    function get_songs() {
        return fetch("http://127.0.0.1:8000/songs")
            .then(res => res.json())
            .then(data => {
                if (data.length > 0) {
                    return data;
                } else {
                    console.log("not found");
                    return [];
                }
            });
    }


    async function updateSongList() {
        const songListWrapper = document.getElementById('song-list');
        songListWrapper.innerHTML = '';
        const savedSongs = await get_songs()

        if (!savedSongs || savedSongs.length === 0) {
            const emptyItem = document.createElement('div');
            emptyItem.classList.add('song-item', 'empty');
            emptyItem.textContent = 'No songs found. Click "Add New" to start.';
            songListWrapper.appendChild(emptyItem);
            return;
        }

        for (const song of savedSongs) {
            const songItem = document.createElement('div');
            songItem.classList.add('song-item');

            const songTitle = document.createElement('p');
            songTitle.textContent = song.title;
            songTitle.classList.add('song-title');

            const songIdNumber = document.createElement('p');
            songIdNumber.textContent = "ID: " + song.id;
            songIdNumber.classList.add('song-id');


            const songTimestamp = document.createElement('p');
            songTimestamp.textContent = new Date(song.created_date).toLocaleString();
            songTimestamp.classList.add('song-timestamp');


            songItem.appendChild(songTitle);
            songItem.appendChild(songIdNumber);
            songItem.appendChild(songTimestamp);

            songItem.addEventListener('click', () => {
                openCreateSongPage(song.id);
            });

            songListWrapper.appendChild(songItem);
        }
    }

    updateSongList()

</script>
</body>

</html>